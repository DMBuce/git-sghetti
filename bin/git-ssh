#!/bin/bash

# define some vars
prog="${0##*/}"
SUBDIRECTORY_OK=Yes
NONGIT_OK=
USAGE='<command>'
LONG_USAGE="SSH into the upstream repository of the current branch ('origin' by default) and
run \`<command>\`."

# set up shell functions, define $GIT_DIR, $GIT_OBJECT_DIRECTORY
. "$(git --exec-path)/git-sh-setup"

# check args
if [[ -z "$*" || "$*" == *--help* ]]; then
	die "$LONG_USAGE"
fi

# parse args
cmd="$*"

# parse remote url
. git-sghetti

# make sure we have an ssh url
if [[ "$flavor" != ssh ]]; then
	die "Not an ssh url: $url"
fi

# determine ssh target
target="$host"
if [[ -n "$user" ]]; then
	target="$user@$host"
fi

# run command from remote repo
set -x
ssh "$target" "mkdir -p $dir && cd $dir || exit; $cmd"

